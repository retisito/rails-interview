<div id="todo_item_<%= todo_item.id %>" 
     class="list-group-item <%= 'bg-light' if todo_item.completed? %>" 
     data-controller="task"
     data-task-task-id-value="<%= todo_item.id %>" 
     data-task-status-value="<%= todo_item.completed? ? 'completed' : 'pending' %>">
  
  <!-- Contenedor principal con flexbox -->
  <div class="d-flex justify-content-between align-items-start">
    
    <!-- Lado izquierdo: Checkbox + Contenido -->
    <div class="d-flex align-items-start flex-grow-1">
      
      <!-- Checkbox -->
      <div class="me-3">
        <%= form_with model: [todo_list, todo_item], 
                      url: toggle_todo_list_todo_item_path(todo_list, todo_item),
                      method: :patch, 
                      local: true do |form| %>
          <%= form.check_box :completed, 
              checked: todo_item.completed?,
              onchange: "this.form.submit();",
              class: "form-check-input" %>
        <% end %>
      </div>
      
      <!-- Contenido de la tarea -->
      <div class="flex-grow-1">
        
        <!-- Título y estado -->
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="<%= 'text-decoration-line-through text-muted' if todo_item.completed? %>">
            <%= todo_item.description %>
          </span>
          
          <!-- Estado de procesamiento -->
          <span class="task-status-badge" 
                data-task-target="status" 
                style="<%= 'display: none;' unless todo_item.completed? %>">
            <% if todo_item.completed? %>
              <i class="bi bi-check-circle-fill text-success me-1"></i>
              <small class="text-success fw-bold">Completada</small>
            <% else %>
              <i class="bi bi-clock text-warning me-1"></i>
              <small class="text-warning">Pendiente</small>
            <% end %>
          </span>
        </div>
        
        <!-- Mini barra de progreso individual -->
        <div class="mini-progress-container mb-2" 
             data-task-target="progressContainer" 
             style="display: none;">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <small class="text-muted">Procesando...</small>
            <small class="fw-bold" data-task-target="percentage">0%</small>
          </div>
          <div class="progress" style="height: 6px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" 
                 role="progressbar" 
                 style="width: 0%" 
                 data-task-target="bar"
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
            </div>
          </div>
        </div>
        
        <!-- Fecha de creación -->
        <small class="text-muted">
          <i class="bi bi-calendar me-1"></i>
          <%= todo_item.created_at.strftime("%d/%m/%Y %H:%M") %>
        </small>
        
      </div>
    </div>
    
    <!-- Lado derecho: Botones de acción -->
    <div class="btn-group ms-3" role="group">
      <%= link_to edit_todo_list_todo_item_path(todo_list, todo_item), 
                  class: "btn btn-outline-secondary btn-sm" do %>
        <i class="bi bi-pencil"></i>
      <% end %>
      <%= link_to [todo_list, todo_item], 
                  method: :delete,
                  class: "btn btn-outline-danger btn-sm",
                  confirm: "¿Eliminar esta tarea?",
                  data: { "turbo-method": :delete } do %>
        <i class="bi bi-trash"></i>
      <% end %>
    </div>
    
  </div>
</div>